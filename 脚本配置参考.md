# 脚本配置参考文档

## 通用配置参数

### 基础配置
```javascript
// 调试模式开关
var isDebug = false;

// 确认按钮坐标（建议配置）
const ConfirmX = 878;
const ConfirmY = 2263;
```

### 时间同步配置
```javascript
// 网络延迟补偿（毫秒）
const networkDelay = 45;

// 时间同步函数
function getDamaiTimestamp() {
    return new Date().getTime();
}
```

## 猫眼脚本配置

### MaoYanGoNew.js - 卡点抢票

#### 核心配置
```javascript
// 确认按钮坐标
const ConfirmX = 878;
const ConfirmY = 2263;

// 调试模式
var isDebug = false;

// 调试模式下的票档点击坐标
const debugTicketClickX = 207;
const debugTicketClickY = 1170;
```

#### 使用示例
```javascript
// 1. 开启调试模式测试
var isDebug = true;

// 2. 配置确认按钮坐标（根据设备调整）
const ConfirmX = 878;  // 根据实际设备调整
const ConfirmY = 2263; // 根据实际设备调整

// 3. 运行脚本
// 脚本会自动检测预约状态并等待开票
```

### MaoYanMonitor.js - 余票监控

#### 核心配置
```javascript
// 监控刷新间隔（秒）
const monitorIntervalSeconds = 2;

// WebHook 通知地址
const webHookNoticeUrl = "";

// 是否响铃提醒
const isRingingBell = true;

// 调试模式
var isDebug = false;

// 默认参数（可选）
var defaultPlayEtcStr;    // 默认场次，如："05-18,05-19"
var defaultMaxTicketPrice; // 默认最高票价，如：800
var defaultViewers;       // 默认观演人，如："张三,李四"
```

#### 高级配置
```javascript
// 票档扫描间隔（毫秒）
const scanInterval = 50;

// 自动刷新线程
threads.start(function () {
    log('刷新按钮自动点击线程已启动')
    while(true){
        textContains("刷新").waitFor()
        textContains("刷新").findOne().click()
        log("点击刷新...")
        sleep(100)
    }
});
```

#### 使用示例
```javascript
// 1. 设置默认参数（可选）
var defaultPlayEtcStr = "05-18,05-19";
var defaultMaxTicketPrice = "800";
var defaultViewers = "张三,李四";

// 2. 配置通知
const webHookNoticeUrl = "http://your-webhook-url.com";
const isRingingBell = true;

// 3. 调整监控间隔
const monitorIntervalSeconds = 1; // 更频繁的监控

// 4. 运行脚本
// 脚本会提示输入参数或使用默认值
```

## 纷玩岛脚本配置

### FenWanDaoGo.js - 卡点抢票

#### 核心配置
```javascript
// 确认按钮坐标
const ConfirmX = 878;
const ConfirmY = 2263;

// 调试模式
var isDebug = false;

// 调试模式下的票档点击坐标
const debugTicketClickX = 700;
const debugTicketClickY = 990;
```

#### 时间配置
```javascript
// 时间格式：MM-DD HH:mm
// 示例：04-21 16:18

// 时间解析函数
function parseTime(inputTime) {
    var times = inputTime.split(" ");
    var time1 = times[0];
    var time2 = times[1];
    var monthDay = time1.split("-");
    var month = monthDay[0] - 1;
    var day = monthDay[1];
    var hourMinute = time2.split(":");
    var hour = hourMinute[0];
    var minute = hourMinute[1];
    
    return { month, day, hour, minute };
}
```

#### 使用示例
```javascript
// 1. 配置时间格式
// 输入格式：MM-DD HH:mm
// 例如：04-21 16:18

// 2. 调整坐标（如需要）
const ConfirmX = 878;
const ConfirmY = 2263;

// 3. 开启调试模式测试
var isDebug = true;

// 4. 运行脚本
// 输入抢票时间，脚本自动卡点抢票
```

## 通知配置

### WebHook 通知
```javascript
// 在监控脚本中配置
const webHookNoticeUrl = "http://your-webhook-url.com";

// 发送通知函数
function webHookSend(content) {
    if (webHookNoticeUrl) {
        threads.start(function() {
            try {
                http.post(webHookNoticeUrl, {
                    content: content,
                    timestamp: new Date().getTime()
                });
            } catch (e) {
                console.log("WebHook 发送失败：" + e);
            }
        });
    }
}
```

### 邮件通知（后端服务）
```bash
# 启动后端服务
cd ticket-notice
mvn spring-boot:run

# API 调用示例
curl -X POST http://localhost:8080/notice/email \
  -H "Content-Type: application/json" \
  -H "Authentication: your-api-key" \
  -d '{
    "addr": "your-email@example.com",
    "title": "抢票成功通知",
    "content": "已成功抢到票，请及时支付"
  }'
```

### 响铃提醒
```javascript
// 响铃函数
function ringingBell(铃声类型, 是否循环播放, 播放时长) {
    if (isRingingBell) {
        // 播放提示音
        media.playMusic("path/to/sound.mp3");
        if (是否循环播放) {
            setTimeout(() => {
                media.stopMusic();
            }, 播放时长);
        }
    }
}
```

## 设备适配配置

### 坐标获取方法
1. **使用 AutoX.js 开发者工具**
   ```javascript
   // 在控制台运行
   events.on("click", function(x, y) {
       console.log("点击坐标：", x, y);
   });
   ```

2. **手动测试坐标**
   ```javascript
   // 测试点击
   click(x, y);
   sleep(1000);
   ```

### 常见设备坐标参考
```javascript
// 小米手机
const ConfirmX = 878;
const ConfirmY = 2263;

// 华为手机
const ConfirmX = 900;
const ConfirmY = 2300;

// 三星手机
const ConfirmX = 850;
const ConfirmY = 2200;
```

## 性能优化配置

### 扫描频率优化
```javascript
// 高频率监控（适合热门演出）
const monitorIntervalSeconds = 1;
const scanInterval = 30;

// 低频率监控（适合冷门演出）
const monitorIntervalSeconds = 5;
const scanInterval = 100;
```

### 内存优化
```javascript
// 定期清理内存
setInterval(() => {
    gc();
}, 60000); // 每分钟清理一次
```

### 网络优化
```javascript
// 网络延迟补偿
const networkDelay = 45; // 根据网络情况调整

// 重试机制
function retryOperation(operation, maxRetries = 3) {
    for (let i = 0; i < maxRetries; i++) {
        try {
            return operation();
        } catch (e) {
            if (i === maxRetries - 1) throw e;
            sleep(1000);
        }
    }
}
```

## 调试配置

### 调试模式设置
```javascript
// 开启调试模式
var isDebug = true;

// 调试日志
function debugLog(message) {
    if (isDebug) {
        console.log("[DEBUG] " + message);
    }
}
```

### 错误处理
```javascript
// 全局错误处理
events.on("exit", function() {
    console.log("脚本已退出");
});

events.on("error", function(err) {
    console.log("脚本出错：" + err);
});
```

## 配置检查清单

### 基础检查
- [ ] AutoX.js 已安装并开启无障碍服务
- [ ] 票务 APP 已安装并完成实名认证
- [ ] 观演人信息已添加
- [ ] 支付方式已绑定

### 脚本配置检查
- [ ] 坐标配置正确（如需要）
- [ ] 调试模式设置正确
- [ ] 时间格式正确（卡点抢票）
- [ ] 监控参数正确（余票监控）

### 通知配置检查
- [ ] WebHook 地址正确（如使用）
- [ ] 邮件服务配置正确（如使用）
- [ ] 响铃提醒设置正确

### 测试检查
- [ ] 已进行调试测试
- [ ] 脚本流程正常
- [ ] 点击操作准确
- [ ] 通知功能正常

---

**配置完成后，建议先在调试模式下测试，确保一切正常后再正式使用。** 